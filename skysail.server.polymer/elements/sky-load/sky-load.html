<link rel="import" href="/_polymer/bower_components/polymer/polymer.html">
<link rel="import" href="/_polymer/bower_components/iron-ajax/iron-ajax.html">

<!--
`sky-load`
jquery load wrapper for polymer

@demo demo/index.html 
-->

<dom-module id="sky-load">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <iron-ajax
        auto
        verbose
        url="/webconsole/v1"
	    params='{"media":"html"}'
	    headers='{"Accept": "text/html"}'
	    handle-as="text"
	    on-response="handleResponse"
        last-response="{{data}}"
        on-response="handleResponse"
	    debounce-duration="300"></iron-ajax>
    
    <textarea id="ta1">{{data}}</textarea>
    <div id="ta2">***</div>
    
  </template>

  <script>
    Polymer({

      is: 'sky-load',

      properties: {
        prop1: {
          type: String,
          value: 'prop',
        },
        url: String,
      },
      handleResponse: function(e, request) {
        //console.log(e.detail.response);
        //console.log(this.$.ajax.lastResponse);
        //var self = this;
        //console.log(e);
        //console.log(request);
        var headers = request.xhr.getAllResponseHeaders();
        var response = e.detail.response;//request.xhr.response;
        var ta2 = document.getElementById("ta2");
        var remoteHtml = $.parseHTML(response, document, true);
        console.log(remoteHtml);
        var output = $("<div>").append(remoteHtml).find("#mainContentDiv").html();
        console.log(output);
        //alert(output.get(0));
        //console.log(JSON.stringify(output.get(0));
        $("#ta2").html(output);
      },
     /* attached: function() {
        console.log("SKY-AJAX-GET (attached)>");
        this.$.ajax.url=this.url;
        this.$.ajax.generateRequest();
      },*/
    });
  </script>
</dom-module>
