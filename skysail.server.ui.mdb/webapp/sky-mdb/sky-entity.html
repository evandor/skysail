<link rel="import" href="/_polymer/bower_components/polymer/polymer.html">

<dom-module id="sky-entity">

  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <table class="table">
      <template is="dom-repeat" items="{{fields}}">
  	    <tr><th>{{item.name}}</th><td id="{{getTdId(item.name)}}">{{getData(data,item)}}</td></tr>
      </template>
	</table>

    <template is="dom-repeat" items="{{fields}}">
		{{getData2(data,item)}}
    </template>
    	
	<div><b>data</b>: {{debug(data)}}</div>
	<div><b>meta</b>:{{debug(fields)}}</div>
	
	<content></content>
  </template>

  <script>
    Polymer({

      is: 'sky-entity',

      properties: {
       	fields: {
		    type: Array, 
    		value: function () { return []; } 
  		},
       	data: {
		    type: Array, 
    		value: function () { return []; } 
  		}
      },
   	  getData: function(data, item) {
   	  	if (item.inputType == "TABLE") {
   	  		return "_td_" + item.name;
   	  	} 
		return data[0][item.name];
	  },
   	  getData2: function(data, item) {
   	  	if (item.inputType == "TABLE") {
   	  		document.querySelector("#_td_indices").innerHTML = "<sky-table data='"+JSON.stringify(data[0][item.name])+"'></sky-table>";
   	  	} 
	  },
	  getTdId: function(name) {
	  	  return "_td_" + name;
	  },
   	  debug: function(input) {
		return JSON.stringify(input);
	  }
    });
  </script>
</dom-module>
